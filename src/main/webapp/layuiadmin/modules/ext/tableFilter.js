layui.define(["table","form","laydate","util","excel","laytpl"],function(exports){var $=layui.jquery,table=layui.table,form=layui.form,laydate=layui.laydate,laytpl=layui.laytpl,util=layui.util,excel=layui.excel,columnsTimeOut,dorpListTimeOut,conditionTimeOut,bfColumnTimeOut,bfCond1TimeOut,isFilterReload={},cache={},HIDE="layui-hide",maxId=1,where_cache={},isFilterCache={},table_cache={},conditionChangeItems={eq:"等于",ne:"≠ 不等于",gt:"> 大于",ge:"≥ 大于等于",lt:"< 小于",le:"≤ 小于等于",contain:"包含",notContain:"不包含",start:"以...开头",end:"以...结尾",null:"为空",notNull:"不为空"},dateTimeItems={all:"全部",yesterday:"昨天",thisWeek:"本周",lastWeek:"上周",thisMonth:"本月",thisYear:"今年"},mod={destroy:function(e){if(e)if(Array.isArray(e))for(var i=0;i<e.length;i++)t(e[i]);else t(e);function t(e){if(e){var i=e.config.id;$("#soul-filter-list"+i).remove(),$("#soulCondition"+i).remove(),$("#soulDropList"+i).remove(),delete isFilterReload[i],delete where_cache[i],delete table_cache[i]}}},clearFilter:function(e){"string"==typeof e&&(e=table_cache[e]),where_cache[e.id]&&where_cache[e.id].filterSos&&"{}"!==where_cache[e.id].filterSos&&(delete where_cache[e.id],this.soulReload(e,!0))},render:function(g){var x,c,k=this,t=$(g.elem),e=t.next().children(".layui-table-box").children(".layui-table-main"),i=t.next().children(".layui-table-box").children(".layui-table-header").children("table"),l=t.next().children(".layui-table-box").children(".layui-table-fixed-l").children(".layui-table-header").children("table"),a=t.next().children(".layui-table-box").children(".layui-table-fixed-r").children(".layui-table-header").children("table"),C=g.id,w=k.getCompleteCols(g.cols),o=g.filter&&g.filter.items||["column","data","condition","editCondition","excel"],d=!1,n=!1,s=void 0===g.excel||!(!g.excel||void 0!==g.excel.on&&!g.excel.on)&&g.excel;for(x=0;x<w.length;x++)w[x].field&&w[x].filter&&(d=!0,0===i.find('th[data-field="'+w[x].field+'"]').children().children(".soul-table-filter").length&&(n=!0,0<i.find('th[data-field="'+w[x].field+'"]').children().children(".layui-table-sort").length?(i.find('th[data-field="'+w[x].field+'"]').children().children(".layui-table-sort").hide(),i.find('th[data-field="'+w[x].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-column="'+w[x].field+'" lay-sort="'+i.find('th[data-field="'+w[x].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(void 0===w[x].filter.split?"":'data-split="'+w[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')):i.find('th[data-field="'+w[x].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-column="'+w[x].field+'" '+(void 0===w[x].filter.split?"":'data-split="'+w[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>'),0<l.find('th[data-field="'+w[x].field+'"]').children().children(".layui-table-sort").length?(l.find('th[data-field="'+w[x].field+'"]').children().children(".layui-table-sort").hide(),l.find('th[data-field="'+w[x].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-column="'+w[x].field+'" lay-sort="'+l.find('th[data-field="'+w[x].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(void 0===w[x].filter.split?"":'data-split="'+w[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')):l.find('th[data-field="'+w[x].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-column="'+w[x].field+'" '+(void 0===w[x].filter.split?"":'data-split="'+w[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>'),0<a.find('th[data-field="'+w[x].field+'"]').children().children(".layui-table-sort").length?(a.find('th[data-field="'+w[x].field+'"]').children().children(".layui-table-sort").hide(),a.find('th[data-field="'+w[x].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-column="'+w[x].field+'" lay-sort="'+a.find('th[data-field="'+w[x].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(void 0===w[x].filter.split?"":'data-split="'+w[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')):a.find('th[data-field="'+w[x].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-column="'+w[x].field+'" '+(void 0===w[x].filter.split?"":'data-split="'+w[x].filter.split+'"')+'><i class="soul-icon soul-icon-filter"></i><i class="soul-icon soul-icon-filter-asc"></i><i class="soul-icon soul-icon-filter-desc"></i></span>')));if(table_cache[g.id]=g,isFilterCache[g.id]=d){if((!g.filter||void 0===g.filter.bottom||g.filter.bottom)&&0===t.next().children(".soul-bottom-contion").length){t.next().children(".layui-table-box").after('<div class="soul-bottom-contion"><div class="condition-items"></div><div class="editCondtion"><a class="layui-btn layui-btn-primary">编辑筛选条件</a></div></div>');var r=t.next().children(".layui-table-box").children(".layui-table-body").outerHeight()-t.next().children(".soul-bottom-contion").outerHeight();g.page&&t.next().children(".layui-table-page").hasClass("layui-hide")&&(r+=t.next().children(".layui-table-page").outerHeight()),t.next().children(".layui-table-box").children(".layui-table-body").css("height",r);var u=r-k.getScrollWidth(e[0]),h=e.children("table").height();t.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-body").css("height",u<=h?u:"auto"),t.next().children(".soul-bottom-contion").children(".condition-items").css("width",t.next().children(".soul-bottom-contion").width()-t.next().children(".soul-bottom-contion").children(".editCondtion").width()+"px"),t.next().children(".soul-bottom-contion").children(".editCondtion").children("a").on("click",function(){k.showConditionBoard(g)})}if(!n||isFilterReload[g.id]||g.isSoulFrontFilter)return isFilterReload[g.id]=!1,g.isSoulFrontFilter=!1,void this.bindFilterClick(g);if(!g.url&&g.page&&g.data&&g.data.length>g.limit&&layui.each(g.data,function(e,i){i[g.indexName]=e}),g.url&&!g.page?cache[g.id]=layui.table.cache[g.id]:cache[g.id]=g.data||layui.table.cache[g.id],g.filter&&g.filter.clearFilter){if(g.where&&g.where.filterSos&&0<JSON.parse(g.where.filterSos).length)return g.where.filterSos="[]",where_cache[g.id]=g.where||{},void k.soulReload(g,!1);where_cache[g.id]=g.where||{}}else{if((void 0===g.url||!g.page||void 0===g.where.filterSos)&&where_cache[g.id]&&0<JSON.parse(where_cache[g.id].filterSos||"[]").length)return g.where.filterSos=where_cache[g.id].filterSos,where_cache[g.id]=g.where,void k.soulReload(g,!1);where_cache[g.id]=g.where||{}}if(0===$("#soul-filter-list"+C).length){(void 0===g.soulSort||g.soulSort)&&(void 0===t.attr("lay-filter")&&t.attr("lay-filter",C),table.on("sort("+t.attr("lay-filter")+")",function(e){g.url&&g.page?(where_cache[g.id].field=e.field,where_cache[g.id].order=e.type,isFilterReload[g.id]=!0,table.render($.extend(g,{initSort:e,where:where_cache[g.id],page:{curr:1}}))):!g.url&&g.page&&("asc"===e.type?cache[g.id]=layui.sort(cache[g.id],e.field):"desc"===e.type?cache[g.id]=layui.sort(cache[g.id],e.field,!0):cache[g.id]=layui.sort(cache[g.id],g.indexName),g.initSort=e,g.page={curr:1},k.soulReload(g,!1))}));var f=[],p={column:'<li class="soul-column"><i class="layui-icon layui-icon-table"></i> 表格列 <i class="layui-icon layui-icon-right" style="float: right"></i></li>',data:'<li class="soul-dropList"><i class="soul-icon soul-icon-drop-list"></i> 筛选数据 <i class="layui-icon layui-icon-right" style="float: right"></i></li>',condition:'<li class="soul-condition"><i class="soul-icon soul-icon-query"></i> 筛选条件 <i class="layui-icon layui-icon-right" style="float: right"></i></li>',editCondition:'<li class="soul-edit-condition"><i class="layui-icon layui-icon-edit"></i> 编辑筛选条件 </li>',excel:'<li class="soul-export"><i class="soul-icon soul-icon-download"></i> 导出excel </li>',clearCache:'<li class="soul-clear-cache"><i class="layui-icon layui-icon-delete"></i> 清除缓存 </li>'};for(f.push('<div id="soul-filter-list'+C+'"><form action="" class="layui-form" lay-filter="orm"><ul id="main-list'+C+'" style="display: none">'),f.push('<li class="soul-sort" data-value="asc" ><i class="soul-icon soul-icon-asc"></i> 升序排列 </li>'),f.push('<li class="soul-sort" data-value="desc"  style="border-bottom: 1px solid #e6e6e6"><i class="soul-icon soul-icon-desc"></i> 降序排列 </li>'),x=0;x<o.length;x++)("excel"!==o[x]||s)&&f.push(p[o[x]]);f.push('</ul><ul id="soul-columns'+C+'" style="display: none;">');var m={};for(x=0;x<w.length;x++)"checkbox"!==w[x].type&&w[x].field?(f.push('<li data-value="'+w[x].field+'" data-key="'+x+'"><input type="checkbox" value="'+(w[x].field||x)+'" title="'+w[x].title+'" data-fixed="'+(w[x].fixed||"")+'" lay-skin="primary" lay-filter="changeColumns'+C+'" '+(w[x].hide?"":"checked")+"></li>"),w[x].filter&&w[x].filter.type&&(w[x].filter.field?m[w[x].filter.field]=w[x].filter.type:m[w[x].field]=w[x].filter.type)):f.push('<li class="layui-hide"><input type="checkbox" title="'+w[x].title+'" /></li>');2!==JSON.stringify(m).length&&(g.where.tableFilterType=JSON.stringify(m)),f.push('</ul><div id="soul-dropList'+C+'" style="display: none"><div class="filter-search"><input type="text" placeholder="关键字搜索" class="layui-input"></div><div class="check"><div class="multiOption" data-type="all"><i class="soul-icon">&#xe623;</i> 全选</div><div class="multiOption" data-type="none"><i class="soul-icon">&#xe63e;</i> 清空</div><div class="multiOption" data-type="reverse"><i class="soul-icon">&#xe614;</i>反选</div></div><ul></ul></div>'),f.push('<ul id="soul-condition'+C+'" style="display: none;"></ul></form></div>'),$("body").append(f.join(""));var y=!0;form.on("checkbox(changeColumns"+C+")",function(e){y=!1,e.elem.checked?(t.next().children(".layui-table-box").children(".layui-table-header").find("thead>tr>th[data-field="+e.value+"]").removeClass(HIDE),t.next().children(".layui-table-box").children(".layui-table-body").find("tbody>tr>td[data-field="+e.value+"]").removeClass(HIDE),t.next().children(".layui-table-total").find("tbody>tr>td[data-field="+e.value+"]").removeClass(HIDE),$(e.elem).data("fixed")&&t.next().children(".layui-table-box").children(".layui-table-fixed-"+$(e.elem).data("fixed").substr(0,1)).find("[data-field="+e.value+"]").removeClass(HIDE)):(t.next().children(".layui-table-box").children(".layui-table-header").find("thead>tr>th[data-field="+e.value+"]").addClass(HIDE),t.next().children(".layui-table-box").children(".layui-table-body").find("tbody>tr>td[data-field="+e.value+"]").addClass(HIDE),t.next().children(".layui-table-total").find("tbody>tr>td[data-field="+e.value+"]").addClass(HIDE),$(e.elem).data("fixed")&&t.next().children(".layui-table-box").children(".layui-table-fixed-"+$(e.elem).data("fixed").substr(0,1)).find("[data-field="+e.value+"]").addClass(HIDE));var i=[].concat.apply([],g.cols);for(x=0;x<i.length;x++)i[x].field&&i[x].field===e.value&&(i[x].hide=!e.elem.checked);k.resize(g),g.filter&&g.filter.cache&&localStorage.setItem(location.pathname+location.hash+g.id,k.deepStringify(g.cols)),t.next().children(".layui-table-box").children(".layui-table-body").children("table").children("tbody").children("tr.childTr").children("td").attr("colspan",t.next().children(".layui-table-box").children(".layui-table-header").find("thead>tr>th:visible").length)}),$("#soul-columns"+C+">li[data-value]").on("click",function(){$(this).find(":checkbox").is(":disabled")||(y&&$(this).find("div.layui-form-checkbox").trigger("click"),y=!0)}),$("#soul-dropList"+C+" .check [data-type]").on("click",function(){switch($(this).data("type")){case"all":$(this).parents("#soul-dropList"+C).find("input[type=checkbox]:not(:checked)").prop("checked",!0);break;case"reverse":$(this).parents("#soul-dropList"+C).find("input[type=checkbox]").each(function(){$(this).prop("checked",!$(this).prop("checked"))});break;case"none":$(this).parents("#soul-dropList"+C).find("input[type=checkbox]:checked").prop("checked",!1)}return form.render("checkbox","orm"),k.updateDropList(g,$("#main-list"+C).data("field")),!1}),$("#soul-dropList"+C+" .filter-search input").on("input",function(){var e=$(this).val();""===e?$("#soul-dropList"+C+">ul>li").show():($("#soul-dropList"+C+">ul>li").hide(),$("#soul-dropList"+C+'>ul>li[data-value*="'+e.toLowerCase()+'"]').show())}),$("#main-list"+C+" .soul-column").on("mouseover",function(e){var i,t;k.hideDropList(g),k.hideCondition(g),e.stopPropagation(),columnsTimeOut&&clearTimeout(columnsTimeOut),$("#soul-columns"+C).show(),t=$(this).parent().offset().left+$(this).parent().width()+$("#soul-columns"+C).width()<document.body.clientWidth?(i=$(this).parent().offset().left+$(this).parent().width(),"fadeInLeft"):(i=$(this).parent().offset().left-$("#soul-columns"+C).width(),"fadeInRight"),$("#soul-columns"+C).css({top:$(this).offset().top,left:i}).removeClass().addClass(t+" animated")}),$("#main-list"+C+" .soul-dropList").on("mouseover",function(e){if($("#soul-dropList"+C).is(":visible")&&!$("#soul-dropList"+C).hasClass("fadeOutLeft"))return!1;k.hideColumns(g),k.hideCondition(g),e.stopPropagation(),dorpListTimeOut&&clearTimeout(dorpListTimeOut),$("#soul-dropList"+C+">.filter-search>input").val(""),$("#soul-dropList"+C).show();var i,t,l=$("#main-list"+C).data("field");t=$("#main-list"+C).offset().left+$("#soul-dropList"+C).width()+$("#soul-dropList"+C).width()<document.body.clientWidth?(i=$("#main-list"+C).offset().left+$("#main-list"+C).width(),"fadeInLeft"):(i=$("#main-list"+C).offset().left-$("#soul-dropList"+C).width(),"fadeInRight"),$("#soulDropList"+C).find("."+l+"DropList li input[type=checkbox]:checked").prop("checked",!1);var a=where_cache[g.id]||{},o=JSON.parse(a.filterSos?a.filterSos:null),d="",n="";if(o)for(x=0;x<o.length;x++)if(o[x].head&&"in"===o[x].mode&&o[x].field===l){for(d=o[x].id,n=o[x].prefix,c=0;c<o[x].values.length;c++)$("#soulDropList"+C).find("."+l+'DropList li input[type=checkbox][value="'+o[x].values[c]+'"]').prop("checked",!0);break}$("#soul-dropList"+C+">ul").data({head:!0,id:d,prefix:n,refresh:!0,split:$("#main-list"+C).data("split")}).html($("#soulDropList"+C).find("."+l+"DropList li").clone()),$("#soul-dropList"+C).css({top:$(this).offset().top,left:i}).show().removeClass().addClass(t+" animated"),setTimeout(function(){$("#soul-dropList"+C+">.filter-search>input").focus(),form.render("checkbox","orm")},1);var s=!0;form.on("checkbox(soulDropList"+C+")",function(e){s=!1,k.updateDropList(g,l)}),$("#soul-dropList"+C+">ul>li[data-value]").on("click",function(){s&&$(this).find("div.layui-form-checkbox").trigger("click"),s=!0})}),$("#main-list"+C+" .soul-condition").on("mouseover",function(e){if($("#soul-condition"+C).is(":visible")&&!$("#soul-condition"+C).hasClass("fadeOutLeft"))return!1;k.hideColumns(g),k.hideDropList(g),e.stopPropagation(),conditionTimeOut&&clearTimeout(conditionTimeOut);var i=document.body.clientWidth;$("#soul-condition"+C).show();var t,l,n=$(this).parent().data("field");l=$(this).parent().offset().left+$(this).parent().width()+$("#soul-condition"+C).width()<i?(t=$(this).parent().offset().left+$(this).parent().width(),"fadeInLeft"):(t=$(this).parent().offset().left-$("#soul-condition"+C).width(),"fadeInRight");var s,a=[],o=where_cache[g.id]||{},d=JSON.parse(o.filterSos?o.filterSos:null);if(d)for(x=0;x<d.length;x++)if(d[x].head&&d[x].field===n&&("date"===d[x].mode||"group"===d[x].mode)){s=d[x];break}var r=$(this).parent().data("type");if(k.startsWith(r,"date"))k.showDate(g,n,s,l,$(this).offset().top,$(this).parent().offset().left+$(this).parent().width(),"down",!0);else{var c={};for(x=0;x<w.length;x++)w[x].field&&(c[w[x].field]=w[x].title);var u="<select lay-filter='conditionChange'>";for(var h in conditionChangeItems)u+='<option value="'+h+'">'+conditionChangeItems[h]+"</option>";if(u+="</select>",a.push('<table class="condition-table"><tbody>'),s&&s.children&&0<s.children.length)for(x=0;x<s.children.length;x++){var f=s.children[x].id,p=s.children[x].prefix,m=s.children[x].type,y=s.children[x].value;for(var h in a.push('<tr data-id="'+f+'">'),0===x?a.push('<td class="soul-condition-title">'+c[n]+"</td>"):a.push('<td>   <div>      <input type="checkbox" name="switch" lay-filter="soul-coondition-switch" lay-skin="switch" lay-text="与|或" '+(p&&"and"!==p?"":"checked")+">    </div></td>"),a.push('<td style="width: 110px;"><div class="layui-block" ><select lay-filter="conditionChange">'),conditionChangeItems)a.push('<option value="'+h+'" '+(h===m?"selected":"")+">"+conditionChangeItems[h]+"</option>");a.push("</select></div></td>"),a.push('<td style="width: 110px;"><div class="layui-block" ><input class="layui-input value" value="'+(y||"")+'" placeholder="值" /></div></td>'),a.push('<td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"></i></td>'),a.push("</tr>")}else a.push('<tr data-id="" data-type="eq" data-value=""><td class="soul-condition-title">'+c[n]+'</td><td style="width: 110px;"><div class="layui-block" >'+u+'</div></td><td style="width: 110px;"><div class="layui-block" ><input class="layui-input value" placeholder="值" /></div></td><td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"></i></td></tr>');function v(e){var i=e.data("id"),t=$("#soul-condition"+C).data("id"),l=e.find('input[lay-filter="soul-coondition-switch"]:checked').prop("checked")?"and":"or",a=e.find("select").val(),o=e.find(".value").val(),d=$("#soul-condition"+C).data("head");s=t?{id:i,prefix:l,mode:"condition",field:n,type:a,value:o,groupId:t}:{head:d,prefix:"and",mode:"group",field:n,children:[{id:k.getDifId(),prefix:l,mode:"condition",field:n,type:a,value:o,groupId:t}]},k.updateWhere(g,s),t?i||e.data("id",s.id):($("#soul-condition"+C).data("id",s.id),e.data("id",s.children[0].id))}function b(e){var i;1===$(e).parents("table:eq(0)").find("tr").length?(i=$("#soul-condition"+C).data("id"),$("#soul-condition"+C).data("id",""),$(e).parents("tr:eq(0)").find("select").val("eq"),$(e).parents("tr:eq(0)").find(".value").val("").show(),form.render("select","orm")):(i=$(e).parents("tr:eq(0)").data("id"),0===$(e).parents("tr:eq(0)").index()&&$(e).parents("table:eq(0)").find("tr:eq(1)>td:eq(0)").html(c[n]).addClass("soul-condition-title"),$(e).parents("tr:eq(0)").remove()),i&&k.updateWhere(g,{id:i,delete:!0})}a.push('</tbody></table><div style="text-align: center; padding-top: 5px"><button class="layui-btn layui-btn-sm" data-type="add"><i class="layui-icon">&#xe654;</i>添加</button><span style="display: inline-block;width: 50px"></span><button class="layui-btn layui-btn-sm" data-type="search"><i class="layui-icon">&#xe615;</i>查询</button></div>'),$("#soul-condition"+C).data({head:!0,id:s&&s.id||""}).html(a.join("")).css({top:$(this).offset().top,left:t}).show().removeClass().addClass(l+" animated"),$(".condition-table").on("click",function(){return!1}),$("#soul-condition"+C+" button[data-type]").on("click",function(){if("add"===$(this).data("type")){var e,i=$("#soul-condition"+C).data("id"),t=$("#soul-condition"+C).data("head"),l=$("#soul-condition"+C).find("tr:eq(0)");e=i?{head:t,prefix:"and",field:n,mode:"condition",type:"eq",value:"",groupId:i}:{head:t,prefix:"and",mode:"group",field:n,children:[{id:k.getDifId(),prefix:"and",field:n,mode:"condition",type:l.find("select").val(),value:l.find(".value").val()},{id:k.getDifId(),prefix:"and",field:n,mode:"condition",type:"eq",value:""}]},k.updateWhere(g,e),i||($("#soul-condition"+C).data("id",e.id),l.data("id",e.children[0].id));var a='<tr data-id="'+(i?e.id:e.children[1].id)+'"><td>   <div>      <input type="checkbox" name="switch" lay-filter="soul-coondition-switch" lay-skin="switch" lay-text="与|或" checked>   </div></td><td style="width: 110px;"><div class="layui-block">'+u+'</div></td><td style="width: 110px;"><div class="layui-block"><input class="layui-input value" placeholder="值" /></div></td><td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"></i></td></tr>';$("#soul-condition"+C+">table>tbody").append(a),$("#soul-condition"+C).find(".del:last").on("click",function(){b(this)}),$("#soul-condition"+C+" input.value:last").on("input",function(){v($(this).parents("tr:eq(0)"))})}else"search"===$(this).data("type")&&k.soulReload(g);return form.render("select","orm"),form.render("checkbox","orm"),!1}),$("#soul-condition"+C+" input.value").on("input",function(){v($(this).parents("tr:eq(0)"))}),form.on("select(conditionChange)",function(e){"null"===e.value||"notNull"===e.value?$(this).parents("tr").find("input.value").hide():$(this).parents("tr").find("input.value").show(),v($(e.elem).parents("tr:eq(0)"))}),form.on("switch(soul-coondition-switch)",function(e){v($(this).parents("tr:eq(0)"))}),$("#soul-condition"+C+" .del").on("click",function(){b(this)})}form.render("select","orm"),form.render("checkbox","orm")}),$("#soul-columns"+C+", #soul-dropList"+C).on("mouseover",function(e){e.stopPropagation()}),$("#main-list"+C+" .soul-edit-condition").on("mouseover",function(e){k.hideColumns(g),k.hideDropList(g),k.hideCondition(g),e.stopPropagation()}).on("click",function(){$("#main-list"+C).hide(),k.showConditionBoard(g)}),$("#main-list"+C+" .soul-export").on("mouseover",function(e){k.hideColumns(g),k.hideDropList(g),k.hideCondition(g),e.stopPropagation()}).on("click",function(){$("#main-list"+C).hide(),k.export(table_cache[g.id])}),$("#main-list"+C+" .soul-clear-cache").on("mouseover",function(e){k.hideColumns(g),k.hideDropList(g),k.hideCondition(g),e.stopPropagation()}).on("click",function(){$("#main-list"+C).hide(),localStorage.removeItem(location.pathname+location.hash+g.id),layer.msg("清除成功！请刷新页面！",{icon:1,time:1e3})}),$("#main-list"+C).on("mouseover",function(e){var i=e.pageX,t=e.pageY,l=$(this),a=l.offset().top,o=a+l.height(),d=l.offset().left,n=d+l.width();i<=d||n<=i||t<=a||o<=t||(k.hideColumns(g),k.hideDropList(g),k.hideCondition(g))})}else{for(m={},x=0;x<w.length;x++)"checkbox"!==w[x].type&&w[x].field&&w[x].filter&&w[x].filter.type&&(w[x].filter.field?m[w[x].filter.field]=w[x].filter.type:m[w[x].field]=w[x].filter.type);2!==JSON.stringify(m).length&&(g.where.tableFilterType=JSON.stringify(m))}if(0===$("#soulDropList"+C).length&&$("body").append('<div id="soulDropList'+C+'" style="display: none"></div>'),0<i.find(".soul-table-filter").length){var v=[];if(i.find(".soul-table-filter").each(function(e,i){$(this).data("column")&&v.push($(this).data("column"))}),-1!==o.indexOf("data"))if(void 0!==g.url&&g.page){var b=JSON.parse(JSON.stringify(g.where)),L=g.url;b.columns=JSON.stringify(v),$.ajax({url:L,data:b,dataType:"json",method:"post",headers:g.headers||{},contentType:g.contentType,success:function(e){var i=[];for(var t in e){var l=e[t];if(1===l.length&&""===l[0]||0===l.length)i.push("<ul class='"+t+"DropList' data-value='"+t+"'><li style='color: gray;line-height: 25px;padding-left: 20px;'>(无数据)</li></ul>");else{var a=[];a.push("<ul class='"+t+"DropList' data-value='"+t+"'>");var o=w;for(c=0;c<o.length;c++)if(o[c].field===t){if(o[c].filter.split){var d=[];for(x=0;x<l.length;x++)for(var n=l[x].split(o[c].filter.split),s=0;s<n.length;s++)-1===d.indexOf(n[s])&&d.push(n[s]);l=d}for(l.sort(function(e,i){return isNaN(e)||isNaN(i)?String(e)>=String(i):Number(e)-Number(i)}),x=0;x<l.length;x++)if(l[x]){var r={};r[t]=l[x],a.push('<li data-value="'+String(l[x]).toLowerCase()+'"><input type="checkbox" value="'+l[x]+'" title="'+((o[c].templet&&"function"==typeof o[c].templet?o[c].templet.call(this,r):l[x])+"").replace(/\"|\'/g,"'")+'" lay-skin="primary" lay-filter="soulDropList'+C+'"></li>')}break}a.push("</ul>"),i.push(a.join(""))}}$("#soulDropList"+C).html(i.join(""))},error:function(){}})}else{var S=cache[g.id],I={};for(x=0;x<S.length;x++)for(c=0;c<v.length;c++){var O=void 0===S[x][v[c]]?"":S[x][v[c]];I[v[c]]?-1===I[v[c]].indexOf(O)&&I[v[c]].push(O):I[v[c]]=[O]}var D=w,T=[];for(c=0;c<D.length;c++){var N=D[c].field,_=I[N];if(!_||1===_.length&&""===_[0])T.push("<ul class='"+N+"DropList' data-value='"+N+"'><li style='color: gray;line-height: 25px;padding-left: 20px;'>(无数据)</li></ul>");else{if(D[c].filter&&D[c].filter.split){var F=[];for(x=0;x<_.length;x++)for(var R=String(_[x]).split(D[c].filter.split),E=0;E<R.length;E++)-1===F.indexOf(R[E])&&F.push(R[E]);_=F}_.sort(function(e,i){return isNaN(e)||isNaN(i)?String(e)>=String(i):Number(e)-Number(i)});var P=[];for(P.push("<ul class='"+N+"DropList' data-value='"+N+"'>"),x=0;x<_.length;x++)if(_[x]){var A={};A[N]=_[x],P.push('<li data-value="'+String(_[x]).toLowerCase()+'"><input type="checkbox" value="'+_[x]+'" title="'+((D[c].templet&&"function"==typeof D[c].templet?D[c].templet.call(this,A):_[x])+"").replace(/\"|\'/g,"'")+'" lay-skin="primary" lay-filter="soulDropList'+C+'"></li>')}P.push("</ul>"),T.push(P.join(""))}}$("#soulDropList"+C).html(T.join(""))}else k.bindFilterClick(g)}this.bindFilterClick(g)}},showConditionBoard:function(p){var a,m,y=this,v=p.id,e=where_cache[p.id]||{},o=e.tableFilterType?JSON.parse(e.tableFilterType):{},i=e.filterSos?JSON.parse(e.filterSos):[],d=[],n={},t=y.getCompleteCols(p.cols);for(m=0;m<t.length;m++)t[m].field&&t[m].filter&&(a||(a=t[m]),n[t[m].field]=t[m].title);for(d.push('<div class="soul-edit-out">'),d.push('<div class="layui-form" lay-filter="soul-edit-out">'),d.push('<div><a class="layui-btn layui-btn-sm" data-type="addOne"><i class="layui-icon layui-icon-add-1"></i> 添加条件</a><a class="layui-btn layui-btn-sm" data-type="addGroup"><i class="layui-icon layui-icon-add-circle" ></i> 添加分组</a><a class="layui-btn layui-btn-sm" data-type="search" style="float: right"><i class="layui-icon layui-icon-search"></i> 查询</a><span style="float: right"><input type="checkbox" lay-filter="out_auto" class="out_auto" title="实时更新"></span></div>'),d.push("<hr>"),d.push("<ul>"),m=0;m<i.length;m++)c(i[m],d,n,0===m,m===i.length-1);function c(e,i,t,l,a){var o=e.id,d=e.field,n=e.mode,s=e.type,r="or"===e.prefix;switch(i.push('<li data-id="'+o+'" data-field="'+d+'" '+(a?'class="last"':"")+' data-mode="'+n+'" data-type="'+s+'" data-value="'+(void 0===e.value?"":e.value)+'" >'),i.push('<div><table><tbody><tr><td data-type="top"></td></tr><tr><td data-type="bottom"></td></tr></tbody></table></div>'),i.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" '+(r?"":"checked")+"></div>"),n){case"in":i.push('<div class="layui-firebrick item-field">'+t[d]+"</div>"),i.push('<div class="layui-deeppink item-type" >筛选数据</div>'),i.push('<div class="layui-blueviolet item-value">共'+(e.values?e.values.length:0)+"条数据</div>"),i.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>');break;case"date":i.push('<div class="layui-firebrick item-field">'+t[d]+"</div>"),i.push('<div class="layui-deeppink item-type">选择日期</div>'),i.push('<div class="layui-blueviolet item-value">'+("specific"===e.type?e.value||"请选择":dateTimeItems[e.type])+"</div>"),i.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>');break;case"condition":i.push('<div class="layui-firebrick item-field">'+t[d]+"</div>"),i.push('<div class="layui-deeppink item-type">'+conditionChangeItems[e.type]+"</div>"),"null"!==s&&"notNull"!==s&&i.push('<div class="layui-blueviolet item-value">'+(void 0===e.value||""===e.value?"请输入...":e.value)+"</div>"),i.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>');break;case"group":if(i.push('<div class="layui-firebrick">分组</div>'),i.push('<div><a class="layui-btn layui-btn-xs" data-type="addOne"><i class="layui-icon layui-icon-add-1"></i> 添加条件</a><a class="layui-btn layui-btn-xs" data-type="addGroup"><i class="layui-icon layui-icon-add-circle"></i> 添加分组</a></div>'),i.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>'),i.push('<ul class="group '+(a?"":"line")+'">'),e.children)for(m=0;m<e.children.length;m++)c(e.children[m],i,t,0===m,m===e.children.length-1);i.push("</ul>")}i.push("</li>")}function s(e){y.hideDropList(p),y.hideCondition(p),y.hideColumns(p),y.hideBfPrefix(p),y.hideBfType(p);var i=$(e).offset().top+$(e).outerHeight(),t=$(e).offset().left;$("#soul-bf-column"+v).find("li.soul-bf-selected").removeClass("soul-bf-selected"),$("#soul-bf-column"+v).data("field",$(e).parent().data("field")).data("id",$(e).parent().data("id")).data("mode",$(e).parent().data("mode")).data("group",$(e).parents("li:eq(2)").data("id")||"").data("refresh",$(".soul-edit-out .out_auto").prop("checked")).show().css({top:i,left:t}).removeClass().addClass("fadeInUp animated").find('li[data-field="'+$(e).parent().data("field")+'"]').addClass("soul-bf-selected")}function r(e){y.hideDropList(p),y.hideCondition(p),y.hideColumns(p),y.hideBfColumn(p),y.hideBfPrefix(p);var i=$(e).offset().top+$(e).outerHeight(),t=$(e).offset().left,l=$(e).parent().data("field");switch(o[l]&&0===o[l].indexOf("date")?$("#soul-bf-type"+v+" li[data-mode=date]").show():$("#soul-bf-type"+v+" li[data-mode=date]").hide(),$("#soul-bf-type"+v).find("li.soul-bf-selected").removeClass("soul-bf-selected"),$(e).parent().data("mode")){case"in":$("#soul-bf-type"+v).find('li[data-mode="in"]').addClass("soul-bf-selected");break;case"date":$("#soul-bf-type"+v).find('li[data-mode="date"]').addClass("soul-bf-selected");case"condition":$("#soul-bf-type"+v).find('li[data-value="'+$(e).parent().data("type")+'"]').addClass("soul-bf-selected")}$("#soul-bf-type"+v).data("type",$(e).parent().data("type")).data("mode",$(e).parent().data("mode")).data("id",$(e).parent().data("id")).data("group",$(e).parents("li:eq(2)").data("id")||"").data("refresh",$(".soul-edit-out .out_auto").prop("checked")).show().css({top:i,left:t}).removeClass().addClass("fadeInUp animated")}function u(i){y.hideColumns(p),y.hideBfType(p),y.hideBfPrefix(p),y.hideBfColumn(p);var e=$(i).offset().left,t=$(i).parent().data("mode"),l=$(i).parent().data("field"),a=$(i).parent().data("id"),o=$(i).parent().data("head"),d=$(i).parent().data("prefix"),n=$(i).parent().data("value"),s=$(".soul-edit-out .out_auto").prop("checked"),r=where_cache[p.id]||{},c=r.filterSos?JSON.parse(r.filterSos):[];switch(t){case"in":if(y.hideCondition(p),dorpListTimeOut&&clearTimeout(dorpListTimeOut),$("#soul-dropList"+v+">.filter-search>input").val(""),$("#soul-dropList"+v).show(),$("#soulDropList"+v).find("."+l+"DropList li input[type=checkbox]:checked").prop("checked",!1),(h=y.getFilterSoById(c,a)).values)for(m=0;m<h.values.length;m++)$("#soulDropList"+v).find("."+l+'DropList li input[type=checkbox][value="'+h.values[m]+'"]').prop("checked",!0);$("#soul-dropList"+v+">ul").data("id",a).data("head",o).data("refresh",s).data("prefix",d).html($("#soulDropList"+v).find("."+l+"DropList li").clone()),form.render("checkbox","orm"),f=$(i).offset().top+$(i).outerHeight(),$("#soul-dropList"+v).css({top:f,left:e}).show().removeClass().addClass("fadeInUp animated"),setTimeout(function(){$("#soul-dropList"+v+">.filter-search>input").focus()},1);var u=!0;form.on("checkbox(soulDropList"+v+")",function(e){u=!1,y.updateDropList(p,l)}),$("#soul-dropList"+v+">ul>li[data-value]").on("click",function(){u&&$(this).find("div.layui-form-checkbox").trigger("click"),u=!0});break;case"date":y.hideDropList(p),conditionTimeOut&&clearTimeout(conditionTimeOut);var h=y.getFilterSoById(c,a),f=$(i).offset().top+$(i).height();y.showDate(p,l,h,"fadeInUp",f,e,"down",s);break;case"condition":$(i).hide(),$(i).after('<div><input class="layui-input tempValue" value="" /></div>'),$(i).next().children().val(n).select().on("keydown",function(e){13===e.keyCode&&$(this).blur()}).on("blur",function(){var e=$(this).val();$(i).html(void 0===e||""===e?"请输入...":e),$(i).show(),$(this).parent().remove(),e!==n&&($(i).parent().data("value",e),y.updateWhere(p,{id:a,value:e}),s&&y.soulReload(p))})}}d.push("</ul>"),d.push("</div>"),d.push("</div>"),layer.open({title:"编辑条件",type:1,offset:"auto",area:["480px","480px"],content:d.join("")}),form.render(null,"soul-edit-out"),form.on("checkbox(out_auto)",function(e){e.elem.checked&&y.soulReload(p)}),form.on("switch(soul-edit-switch)",function(e){var i,t,l,a;t=(i=e).elem.checked?"and":"or",l=$(i.elem).parents("li:eq(0)").data("id"),a=$(".soul-edit-out .out_auto").prop("checked"),$(i.elem).parents("li:eq(0)").data("prefix",t),y.updateWhere(p,{id:l,prefix:t}),a&&y.soulReload(p)}),$(".soul-edit-out .item-field").on("click",function(e){e.stopPropagation(),s(this)}),$(".soul-edit-out .item-type").on("click",function(e){e.stopPropagation(),r(this)}),$(".soul-edit-out .item-value").on("click",function(e){e.stopPropagation(),u(this)}),$(".soul-edit-out .delete-item").on("click",function(){var e=$(this).parent().data("id"),i=$(".soul-edit-out .out_auto").prop("checked");$(this).parent().remove(),y.updateWhere(p,{id:e,delete:!0}),i&&y.soulReload(p)}),$(".soul-edit-out a[data-type]").on("click",function(){"search"===$(this).data("type")?y.soulReload(p):function e(i){var t=$(".soul-edit-out .out_auto").prop("checked");d=[];switch($(i).data("type")){case"addOne":var l={prefix:"and",field:a.field,mode:"condition",type:"eq",value:""};$(i).parent().parent().data("id")&&$.extend(l,{groupId:$(i).parent().parent().data("id")}),y.updateWhere(p,l),d.push('<li data-id="'+l.id+'" data-field="'+l.field+'" data-mode="'+l.mode+'" data-type="'+l.type+'" data-value="'+l.value+'" data-prefix="'+l.prefix+'" class="last">'),d.push('<div><table><tbody><tr><td data-type="top"></td></tr><tr><td data-type="bottom"></td></tr></tbody></table></div>'),d.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" checked></div>'),d.push('<div class="layui-firebrick item-field">'+n[l.field]+"</div>"),d.push('<div class="layui-deeppink item-type">等于</div>'),d.push('<div class="layui-blueviolet item-value">请输入...</div>'),d.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>'),d.push("</li>");break;case"addGroup":var l={prefix:"and",mode:"group",children:[]};$(i).parent().parent().data("id")&&$.extend(l,{groupId:$(i).parent().parent().data("id")}),y.updateWhere(p,l),d.push('<li data-id="'+l.id+'" class="last">'),d.push('<div><table><tbody><tr><td data-type="top"></td></tr><tr><td data-type="bottom"></td></tr></tbody></table></div>'),d.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" checked></div>'),d.push('<div class="layui-firebrick">分组</div>'),d.push('<div><a class="layui-btn layui-btn-xs" data-type="addOne"><i class="layui-icon layui-icon-add-1"></i> 添加条件</a><a class="layui-btn layui-btn-xs" data-type="addGroup"><i class="layui-icon layui-icon-add-circle"></i> 添加分组</a></div>'),d.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"></i></div>'),d.push('<ul class="group">'),d.push("</ul>"),d.push("</li>")}t&&y.soulReload(p);0<$(i).parent().parent().children("ul").children("li").length&&($(i).parent().parent().children("ul").children("li:last").removeClass("last"),0<$(i).parent().parent().children("ul").children("li:last").children("ul.group").length&&$(i).parent().parent().children("ul").children("li:last").children("ul.group").addClass("line"));$(i).parent().parent().children("ul").append(d.join(""));form.render("checkbox","soul-edit-out");"addGroup"===$(i).data("type")?$(i).parent().parent().children("ul").children("li:last").find("a[data-type]").on("click",function(){e(this)}):($(i).parent().parent().children("ul").children("li:last").find(".item-field").on("click",function(e){e.stopPropagation(),s(this)}),$(i).parent().parent().children("ul").children("li:last").find(".item-type").on("click",function(e){e.stopPropagation(),r(this)}),$(i).parent().parent().children("ul").children("li:last").find(".item-value").on("click",function(e){e.stopPropagation(),u(this)}));$(i).parent().parent().children("ul").children("li:last").children(".delete-item").on("click",function(){var e=$(this).parent().data("id"),i=$(".soul-edit-out .out_auto").prop("checked");$(this).parent().remove(),y.updateWhere(p,{id:e,delete:!0}),i&&y.soulReload(p)})}(this)})},hideColumns:function(e,i){var t=e.id;$("#soul-columns"+t).removeClass().addClass("fadeOutLeft animated"),columnsTimeOut&&clearTimeout(columnsTimeOut),void 0===i||i?columnsTimeOut=setTimeout(function(e){$("#soul-columns"+t).hide()},500):$("[id^=soul-columns]").hide()},hideDropList:function(e,i){var t=e.id;$("#soul-dropList"+t).removeClass().addClass("fadeOutLeft animated"),dorpListTimeOut&&clearTimeout(dorpListTimeOut),void 0===i||i?dorpListTimeOut=setTimeout(function(e){$("#soul-dropList"+t).hide()},500):$("[id^=soul-dropList]").hide()},hideCondition:function(e,i){var t=e.id;$("#soul-condition"+t).removeClass().addClass("fadeOutLeft animated"),conditionTimeOut&&clearTimeout(conditionTimeOut),void 0===i||i?conditionTimeOut=setTimeout(function(e){$("#soul-condition"+t).hide()},500):$("[id^=soul-condition]").hide()},hideBfPrefix:function(e,i){var t=e.id;$("#soul-bf-prefix"+t).removeClass().addClass("fadeOutDown animated"),bfColumnTimeOut&&clearTimeout(bfColumnTimeOut),void 0===i||i?bfColumnTimeOut=setTimeout(function(){$("#soul-bf-prefix"+t).hide()},500):$("[id=soul-bf-prefix"+t+"]").hide()},hideBfColumn:function(e,i){var t=e.id;$("#soul-bf-column"+t).removeClass().addClass("fadeOutDown animated"),bfColumnTimeOut&&clearTimeout(bfColumnTimeOut),void 0===i||i?bfColumnTimeOut=setTimeout(function(){$("#soul-bf-column"+t).hide()},500):$("[id=soul-bf-column"+t+"]").hide()},hideBfType:function(e,i){var t=e.id;$("#soul-bf-type"+t).removeClass().addClass("fadeOutDown animated"),bfCond1TimeOut&&clearTimeout(bfCond1TimeOut),void 0===i||i?bfCond1TimeOut=setTimeout(function(){$("#soul-bf-type"+t).hide()},500):$("[id=soul-bf-type"+t+"]").hide()},bindFilterClick:function(l){var a,o=this,e=$(l.elem),i=e.next().children(".layui-table-box").children(".layui-table-header").children("table"),t=e.next().children(".layui-table-box").children(".layui-table-fixed-l").children(".layui-table-header").children("table"),d=e.next().children(".layui-table-box").children(".layui-table-fixed-r").children(".layui-table-header").children("table"),n=l.id;function s(i){var e,t;o.hideColumns(l,!1),o.hideDropList(l,!1),o.hideCondition(l,!1),$("[id^=main-list]").hide(),$("#main-list"+n).data({field:i.data("column"),split:i.data("split")}),$("#soul-columns"+n+" [type=checkbox]").attr("disabled",!1),$("#soul-columns"+n+" li[data-key="+i.parents("th").data("key").split("-")[2]+"] [type=checkbox]").attr("disabled",!0),i.hasClass("layui-table-sort")?$("#main-list"+n+" .soul-sort").show():$("#main-list"+n+" .soul-sort").hide(),a&&clearTimeout(a),t=i.offset().left+$("#main-list"+n).outerWidth()<document.body.clientWidth?(e=i.offset().left+10,"fadeInLeft"):(e=i.offset().left-$("#main-list"+n).outerWidth(),"fadeInRight"),$("#main-list"+n).data("type",l.where.tableFilterType&&JSON.parse(l.where.tableFilterType)[i.data("column")]||"").hide().css({top:i.offset().top+10,left:e}).show().removeClass().addClass(t+" animated"),$("#main-list"+n+" .soul-sort").on("click",function(e){i.siblings(".layui-table-sort").find(".layui-table-sort-"+$(this).data("value")).trigger("click"),$("#main-list"+n).hide()}),form.render("checkbox","orm")}i.find(".soul-table-filter").off("click").on("click",function(e){e.stopPropagation(),s($(this))}),t.find(".soul-table-filter").off("click").on("click",function(e){e.stopPropagation(),s($(this))}),d.find(".soul-table-filter").off("click").on("click",function(e){e.stopPropagation(),s($(this))}),$(document).on("click",function(e){$("#main-list"+n).hide(),o.hideColumns(l,!1),o.hideDropList(l,!1),o.hideCondition(l,!1),o.hideBfPrefix(l,!1),o.hideBfColumn(l,!1),o.hideBfType(l,!1)}),$("#main-list"+n+",#soul-columns"+n+",#soul-dropList"+n+",#soul-condition"+n).on("click",function(e){$(this).find(".layui-form-selected").removeClass("layui-form-selected"),e.stopPropagation()}),o.renderBottomCondition(l),$(window).on("resize",function(){o.resize(l)});for(var r=where_cache[l.id]||{},c=JSON.parse(r.filterSos?r.filterSos:"[]"),u=0;u<c.length;u++)if(c[u].head){var h=!1;switch(c[u].mode){case"in":c[u].values&&0<c[u].values.length&&(h=!0);break;case"date":"all"!==c[u].type&&void 0!==c[u].value&&""!==c[u].value&&(h=!0);break;case"group":c[u].children&&0<c[u].children.length&&(h=!0)}i.find('thead>tr>th[data-field="'+c[u].field+'"] .soul-table-filter').attr("soul-filter",""+h),t.find('thead>tr>th[data-field="'+c[u].field+'"] .soul-table-filter').attr("soul-filter",""+h),d.find('thead>tr>th[data-field="'+c[u].field+'"] .soul-table-filter').attr("soul-filter",""+h)}},resize:function(e){var i=$(e.elem),t=i.next().children(".layui-table-box").children(".layui-table-main");if(table.resize(e.id),0<i.next().children(".soul-bottom-contion").length){i.next().children(".soul-bottom-contion").children(".condition-items").css("width",i.next().children(".soul-bottom-contion").width()-i.next().children(".soul-bottom-contion").children(".editCondtion").outerWidth());var l=i.next().height()-i.next().children(".soul-bottom-contion").outerHeight();0<i.next().children(".layui-table-tool").length&&(l-=i.next().children(".layui-table-tool").outerHeight()),0<i.next().children(".layui-table-total").length&&(l-=i.next().children(".layui-table-total").outerHeight()),0<i.next().children(".layui-table-page").length&&(l-=i.next().children(".layui-table-page").outerHeight()),l-=i.next().children(".layui-table-box").children(".layui-table-header").outerHeight(),i.next().children(".layui-table-box").children(".layui-table-body").height(l);var a=l-this.getScrollWidth(t[0]),o=t.children("table").height();i.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-body").height(a<=o?a:"auto")}},updateDropList:function(e,i){$(e.elem);var t=e.id,l=$("#soul-dropList"+t+">ul").data("id"),a=$("#soul-dropList"+t+">ul input[type=checkbox]:checked"),o=[],d=$("#soul-dropList"+t+">ul").data("head"),n=$("#soul-dropList"+t+">ul").data("prefix"),s=$("#soul-dropList"+t+">ul").data("refresh"),r=$("#soul-dropList"+t+">ul").data("split");0<a.length&&a.each(function(){o.push($(this).val())});var c={id:l,head:d,prefix:n||"and",mode:"in",field:i,split:r,values:o};this.updateWhere(e,c),l||$("#soul-dropList"+t+">ul").data("id",c.id),0<$(".soul-edit-out").length&&$('.soul-edit-out li[data-id="'+c.id+'"]>.item-value').html("共"+(c.values?c.values.length:0)+"条数据"),s&&this.soulReload(e)},getFilterSoById:function(e,i){for(var t=0;t<e.length;t++){if(e[t].id===i)return e[t];if("group"===e[t].mode)for(var l=0;l<e[t].children.length;l++){var a=this.getFilterSoById(e[t].children,i);if(a)return a}}return null},updateWhere:function(e,i){var a=this,t=where_cache[e.id]||{},l=JSON.parse(t.filterSos?t.filterSos:"[]");if(i.id||i.groupId)for(var o=0;o<l.length;o++){if(i.delete&&l[o].id===i.id){l.splice(o,1);break}if(d(l[o],i))break}else("in"!==i.mode||i.values&&0<i.values.length)&&l.push($.extend(i,{id:a.getDifId()}));function d(e,i){var t=!1;if(e.id===i.id&&($.extend(e,i),t=!0),i.id||e.id!==i.groupId){if("group"===e.mode)for(var l=0;l<e.children.length;l++){if(i.delete&&e.children[l].id===i.id)return e.children.splice(l,1),!0;if(d(e.children[l],i))return!0}}else e.children.push($.extend(i,{id:a.getDifId()}));return t}t.filterSos=JSON.stringify(l),e.where=t,where_cache[e.id]=t},soulReload:function(e,i){var a=this,t=$(e.elem),l=t.next().children(".layui-table-box").children(".layui-table-main").scrollLeft();if(isFilterReload[e.id]=void 0===i||i,void 0!==e.url&&e.page)t.data("scrollLeft",l),table.reload(e.id,{where:where_cache[e.id]||{},page:{curr:1}});else{var o=where_cache[e.id]||{},d=JSON.parse(o.filterSos?o.filterSos:"[]"),n=o.tableFilterType?JSON.parse(o.tableFilterType):{},s=layer.load(2);if(e.page||(e.limit=1e8),0<d.length){var r=[];if(layui.each(cache[e.id],function(e,i){for(var t=!0,l=0;l<d.length;l++)t=a.handleFilterSo(d[l],i,n,t,0===l);t&&r.push(i)}),e.page)table.reload(e.id,{data:r,initSort:e.initSort,isSoulFrontFilter:!0,page:{curr:1}});else{var c=e.url;t.next().off("click"),table.reload(e.id,{url:"",initSort:e.initSort,isSoulFrontFilter:!0,data:r}).config.url=c}e.data=r}else e.page?table.reload(e.id,{data:cache[e.id],initSort:e.initSort,isSoulFrontFilter:!0,page:{curr:1}}):table.reload(e.id,{data:cache[e.id],initSort:e.initSort,isSoulFrontFilter:!0}),e.data=cache[e.id];t.next().children(".layui-table-box").children(".layui-table-main").scrollLeft(l),layer.close(s)}},handleFilterSo:function(e,i,t,l,a){var o,d,n,s=!a&&"or"===e.prefix,r=e.field,c=e.value,u=!0;if(e.children&&0<e.children.length){for(var h=0;h<e.children.length;h++)u=this.handleFilterSo(e.children[h],i,t,u,0===h);return s?l||u:l&&u}switch(e.mode){case"in":if(!(e.values&&0<e.values.length))return l;if(e.split){var f=(i[r]+"").split(e.split),p=!1;for(h=0;h<f.length;h++)-1!==e.values.indexOf(f[h])&&(p=!0);u=p}else u=-1!==e.values.indexOf(i[r]+"");break;case"condition":if("null"!==e.type&&"notNull"!==e.type&&(void 0===c||""===c))return l;switch(e.type){case"eq":u=isNaN(i[r])||isNaN(c)?i[r]===c:Number(i[r])===Number(c);break;case"ne":u=isNaN(i[r])||isNaN(c)?i[r]!==c:Number(i[r])!==Number(c);break;case"gt":u=isNaN(i[r])||isNaN(c)?i[r]>c:Number(i[r])>Number(c);break;case"ge":u=isNaN(i[r])||isNaN(c)?i[r]>=c:Number(i[r])>=Number(c);break;case"lt":u=isNaN(i[r])||isNaN(c)?i[r]<c:Number(i[r])<Number(c);break;case"le":u=isNaN(i[r])||isNaN(c)?i[r]<=c:Number(i[r])<=Number(c);break;case"contain":u=-1!==(i[r]+"").indexOf(c);break;case"notContain":u=-1===(i[r]+"").indexOf(c);break;case"start":u=0===(i[r]+"").indexOf(c);break;case"end":var m=(i[r]+"").length-(c+"").length;u=0<=m&&(i[r]+"").lastIndexOf(c)===m;break;case"null":u=void 0===i[r]||""===i[r]||null===i[r];break;case"notNull":u=void 0!==i[r]&&""!==i[r]&&null!==i[r]}break;case"date":var y=new Date(Date.parse(i[r].replace(/-/g,"/")));switch(e.type){case"all":u=!0;break;case"yesterday":u=i[r]&&$(y,b()-1,b()-86400);break;case"thisWeek":u=i[r]&&$(y,g(),g()+604800-1);break;case"lastWeek":u=i[r]&&$(y,g()-604800,g()-1);break;case"thisMonth":u=i[r]&&$(y,new Date((new Date).setDate(1)).setHours(0,0,0,0)/1e3,(o=new Date,d=o.getMonth(),n=++d,new Date(o.getFullYear(),n,1)/1e3-1));break;case"thisYear":u=i[r]&&$(y,new Date((new Date).getFullYear(),1,1)/1e3,new Date((new Date).getFullYear()+1,1,1)/1e3-1);break;case"specific":var v=y.getFullYear();v+="-"+x(y.getMonth()+1),v+="-"+x(y.getDate()),u=i[r]&&v===c}}function b(){return(new Date).setHours(0,0,0,0)/1e3}function g(){var e=new Date,i=e.getDay()||7;return new Date(e.setDate(e.getDate()-i+1)).setHours(0,0,0,0)/1e3}function $(e,i,t){return e.getTime()/1e3>=i&&e.getTime()/1e3<=t}function x(e){return(e+="").length<=1&&(e="0"+e),e}return s?l||u:l&&u},getDifId:function(){return maxId++},showDate:function(a,o,e,i,t,l,d,n){var s=this,r=a.id,c=[],u=document.body.clientWidth;for(var h in c.push('<div class="'+o+'Condition" data-value="'+o+'" style="padding: 5px;" >'),c.push('<div class="layui-row">'),dateTimeItems)c.push('<div class="layui-col-sm4"><input type="radio" name="datetime'+r+o+'" lay-filter="datetime'+r+'" value="'+h+'" title="'+dateTimeItems[h]+'"></div>');c.push("</div>"),c.push('<div><input type="radio" name="datetime'+r+o+'" lay-filter="datetime'+r+'"  value="specific" title="过滤具体日期"> <input type="hidden" class="specific_value"><div class="staticDate"></div></div></div>'),$("#soul-condition"+r).html(c.join(""));var f=util.toDateString(new Date,"yyyy-MM-dd");e?($("#soul-condition"+r).data({id:e.id,head:!0}),$("#soul-condition"+r+">."+o+'Condition [name^=datetime][value="'+e.type+'"]').prop("checked",!0),"specific"===e.type&&(f=e.value)):($("#soul-condition"+r).data({id:"",head:!0}),$("#soul-condition"+r+">."+o+'Condition [name^=datetime][value="all"]').prop("checked",!0)),$("#soul-condition"+r+" .specific_value").val(f),laydate.render({elem:"#soul-condition"+r+" .staticDate",position:"static",calendar:!0,btns:["now"],value:f,done:function(e){var i=$("#soul-condition"+r).data("id"),t=$("#soul-condition"+r).data("head");$("#soul-condition"+r+" .specific_value").val(e),$("#soul-condition"+r+" [name^=datetime]:checked").prop("checked",!1),$("#soul-condition"+r+" [name^=datetime][value=specific]").prop("checked",!0);var l={id:i,head:t,prefix:"and",mode:"date",field:o,type:"specific",value:e};s.updateWhere(a,l),i||$("#soul-condition"+r).data("id",l.id),0<$(".soul-edit-out").length&&$('.soul-edit-out li[data-id="'+l.id+'"]').children(".item-value").html(l.value),n&&s.soulReload(a),form.render("radio","orm")}}),form.on("radio(datetime"+r+")",function(e){var i=$("#soul-condition"+r).data("id"),t=$("#soul-condition"+r).data("head"),l={id:i,head:t,prefix:"and",mode:"date",field:o,type:e.value,value:$("#soul-condition"+r+" .specific_value").val()};s.updateWhere(a,l),i||$("#soul-condition"+r).data("id",l.id),0<$(".soul-edit-out").length&&$('.soul-edit-out li[data-id="'+l.id+'"]').children(".item-value").html(dateTimeItems[l.type]||l.value),n&&s.soulReload(a)}),form.render("radio","orm"),"down"===d?i=l+$("#soul-condition"+r).width()<u?"fadeInLeft":(l=l-$("#main-list"+r).width()-$("#soul-condition"+r).width(),"fadeInRight"):t=t-$("#soul-condition"+r).outerHeight()-10,$("#soul-condition"+r).css({top:t,left:l}).show().removeClass().addClass(i+" animated")},bottomConditionHtml:function(e,i,t,l){var a="or"===i.prefix,o=i.field;if("group"!==i.mode){switch(e.push('<div class="condition-item" data-field="'+o+'" data-id="'+i.id+'" data-mode="'+i.mode+'" data-type="'+i.type+'" data-value="'+(void 0===i.value?"":i.value)+'" data-prefix="'+(i.prefix||"and")+'">'),l||e.push('<div class="item-prefix layui-red">'+(a?"或":"与")+"</div> "),e.push('<div class="item-field layui-firebrick">'+t[o]+"</div> "),e.push('<div class="item-type layui-deeppink">'),i.mode){case"in":e.push("筛选数据");break;case"condition":e.push(conditionChangeItems[i.type]);break;case"date":e.push("选择日期");break;default:e.push("未知")}if(e.push("</div> "),"null"!==i.type&&"notNull"!==i.type){switch(e.push('<div class="item-value layui-blueviolet '+("date"===i.mode&&"specific"!==i.type)+'">'),i.mode){case"in":e.push("共"+(i.values?i.values.length:0)+"条数据");break;case"date":e.push("specific"===i.type?i.value||"请选择":dateTimeItems[i.type]);break;case"condition":default:e.push(void 0===i.value||""===i.value?"请输入...":i.value)}e.push("</div>")}e.push('<i class="condition-item-close soul-icon soul-icon-unfold" ></i>'),e.push("</div>")}else if(i.children&&0<i.children.length){e.push('<div class="condition-item" data-id="'+i.id+'" data-prefix="'+(i.prefix||"and")+'">'),l||e.push('<div class="item-prefix layui-red">'+(a?"或":"与")+"</div> ");for(var d=0;d<i.children.length;d++)this.bottomConditionHtml(e,i.children[d],t,0===d);e.push('<i class="condition-item-close soul-icon soul-icon-unfold" ></i>'),e.push("</div>")}},renderBottomCondition:function(f){for(var p=this,e=where_cache[f.id]||{},m=e.filterSos?JSON.parse(e.filterSos):[],d=e.tableFilterType?JSON.parse(e.tableFilterType):{},i=$(f.elem),y=f.id,t=i.next().children(".soul-bottom-contion"),n={},l=[],a=f.filter&&f.filter.items||["column","data","condition","editCondition","excel"],o=p.getCompleteCols(f.cols),s=0;s<o.length;s++)o[s].field&&o[s].filter&&(n[o[s].field]=o[s].title);for(s=0;s<m.length;s++)p.bottomConditionHtml(l,m[s],n,0===s);if(t.children(".condition-items").html(l.join("")),l=[],0===$("#soul-bf-prefix"+y).length&&(l.push('<div id="soul-bf-prefix'+y+'" style="display: none;"><ul>'),l.push('<li data-value="and">与</li>'),l.push('<li data-value="or">或</li>'),l.push("</ul></div>")),0===$("#soul-bf-column"+y).length){for(var r in l.push('<div id="soul-bf-column'+y+'" style="display: none;"><ul>'),n)l.push('<li data-field="'+r+'">'+n[r]+"</li>");l.push("</ul></div>")}if(0===$("#soul-bf-type"+y).length){if(l.push('<div id="soul-bf-type'+y+'" style="display: none;"><ul>'),-1!==a.indexOf("data")&&l.push('<li data-value="in" data-mode="in">筛选数据</li>'),-1!==a.indexOf("condition"))for(var c in l.push('<li data-value="all" data-mode="date">选择日期</li>'),conditionChangeItems)l.push('<li data-value="'+c+'" data-mode="condition">'+conditionChangeItems[c]+"</li>");l.push("</ul></div>")}0===$("#soul-bf-cond2-dropList"+y).length&&l.push('<div id="soul-bf-cond2-dropList'+y+'" style="display: none;"><div class="filter-search"><input type="text" placeholder="关键字搜索" class="layui-input"></div><div class="check"><div class="multiOption" data-type="all"><i class="soul-icon">&#xe623;</i> 全选</div><div class="multiOption" data-type="none"><i class="soul-icon">&#xe63e;</i> 清空</div><div class="multiOption" data-type="reverse"><i class="soul-icon">&#xe614;</i>反选</div></div><ul></ul></div>'),$("body").append(l.join("")),t.find(".item-prefix").off("click").on("click",function(e){e.stopPropagation(),$("#main-list"+y).hide(),p.hideDropList(f),p.hideCondition(f),p.hideColumns(f),p.hideBfColumn(f),p.hideBfType(f);var i=$(this).offset().top-$("#soul-bf-prefix"+y).outerHeight()-10,t=$(this).offset().left;$("#soul-bf-prefix"+y).find("li.soul-bf-selected").removeClass("soul-bf-selected"),$("#soul-bf-prefix"+y).data("id",$(this).parent().data("id")).data("prefix",$(this).parent().data("prefix")).data("refresh",!0).show().css({top:i,left:t}).removeClass().addClass("fadeInUp animated").find('li[data-value="'+$(this).parent().data("prefix")+'"]').addClass("soul-bf-selected")}),t.find(".item-field").off("click").on("click",function(e){e.stopPropagation(),$("#main-list"+y).hide(),p.hideDropList(f),p.hideCondition(f),p.hideColumns(f),p.hideBfPrefix(f),p.hideBfType(f);var i=$(this).offset().top-$("#soul-bf-column"+y).outerHeight()-10,t=$(this).offset().left;$("#soul-bf-column"+y).find("li.soul-bf-selected").removeClass("soul-bf-selected"),$("#soul-bf-column"+y).data("field",$(this).parent().data("field")).data("id",$(this).parent().data("id")).data("mode",$(this).parent().data("mode")).data("group",$(this).parent().parent().data("id")||"").data("refresh",!0).show().css({top:i,left:t}).removeClass().addClass("fadeInUp animated").find('li[data-field="'+$(this).parent().data("field")+'"]').addClass("soul-bf-selected")}),t.find(".item-type").on("click",function(e){e.stopPropagation(),$("#main-list"+y).hide(),p.hideDropList(f),p.hideCondition(f),p.hideColumns(f),p.hideBfColumn(f),p.hideBfPrefix(f);var i=$(this).offset().top-$("#soul-bf-type"+y).outerHeight()-10,t=$(this).offset().left,l=$(this).parent().data("field");switch(d[l]&&0===d[l].indexOf("date")?$("#soul-bf-type"+y+" li[data-mode=date]").show():$("#soul-bf-type"+y+" li[data-mode=date]").hide(),$("#soul-bf-type"+y).find("li.soul-bf-selected").removeClass("soul-bf-selected"),$(this).parent().data("mode")){case"in":$("#soul-bf-type"+y).find('li[data-mode="in"]').addClass("soul-bf-selected");break;case"date":$("#soul-bf-type"+y).find('li[data-mode="date"]').addClass("soul-bf-selected");case"condition":$("#soul-bf-type"+y).find('li[data-value="'+$(this).parent().data("type")+'"]').addClass("soul-bf-selected")}$("#soul-bf-type"+y).data("type",$(this).parent().data("type")).data("mode",$(this).parent().data("mode")).data("id",$(this).parent().data("id")).data("group",$(this).parent().parent().data("id")||"").data("refresh",!0).show().css({top:i,left:t}).removeClass().addClass("fadeInUp animated")}),t.find(".item-value").on("click",function(e){e.stopPropagation(),$("#main-list"+y).hide(),p.hideColumns(f),p.hideBfType(f),p.hideBfPrefix(f),p.hideBfColumn(f);var i=$(this).offset().left,t=$(this).parent().data("mode"),l=$(this).parent().data("field"),a=$(this).parent().data("id"),o=$(this).parent().data("head"),d=$(this).parent().data("prefix");switch(t){case"in":p.hideCondition(f),dorpListTimeOut&&clearTimeout(dorpListTimeOut),$("#soul-dropList"+y+">.filter-search>input").val(""),$("#soul-dropList"+y).show(),$("#soulDropList"+y).find("."+l+"DropList li input[type=checkbox]:checked").prop("checked",!1);for(var n=p.getFilterSoById(m,a),s=0;s<n.values.length;s++)$("#soulDropList"+y).find("."+l+'DropList li input[type=checkbox][value="'+n.values[s]+'"]').prop("checked",!0);$("#soul-dropList"+y+">ul").data("id",a).data("head",o).data("refresh",!0).data("prefix",d).html($("#soulDropList"+y).find("."+l+"DropList li").clone()),form.render("checkbox","orm"),c=$(this).offset().top-$("#soul-dropList"+y).outerHeight()-10,$("#soul-dropList"+y).css({top:c,left:i}).show().removeClass().addClass("fadeInUp animated"),setTimeout(function(){$("#soul-dropList"+y+">.filter-search>input").focus()},1);var r=!0;form.on("checkbox(soulDropList"+y+")",function(e){r=!1,p.updateDropList(f,l)}),$("#soul-dropList"+y+">ul>li[data-value]").on("click",function(){r&&$(this).find("div.layui-form-checkbox").trigger("click"),r=!0});break;case"date":p.hideDropList(f),conditionTimeOut&&clearTimeout(conditionTimeOut);n=p.getFilterSoById(m,a);var c=$(this).offset().top-10;p.showDate(f,l,n,"fadeInUp",c,i,"up",!0);break;default:p.hideDropList(f),conditionTimeOut&&clearTimeout(conditionTimeOut);var u=this,h=$(this).parents(".condition-item:eq(0)").data("value");$(u).hide(),$(u).after('<div><input style="height: 25px;" class="layui-input tempValue" value="" /></div>'),$(u).next().children().val(h).select().on("keydown",function(e){13===e.keyCode&&$(this).blur()}).on("blur",function(){var e=$(this).val();$(u).html(void 0===e||""===e?"请输入...":e),$(u).show(),$(this).parent().remove(),e!==h&&(p.updateWhere(f,{id:a,value:e}),p.soulReload(f))})}}),$("#soul-bf-prefix"+y+">ul>li").off("click").on("click",function(){var e=$(this).parent().parent().data("id"),i=$(this).data("value"),t=$(this).parent().parent().data("prefix"),l=$(this).parent().parent().data("refresh");t!==i&&(p.updateWhere(f,{id:e,prefix:i}),!0===l&&p.soulReload(f))}),$("#soul-bf-column"+y+">ul>li").off("click").on("click",function(){var e=$(this).parent().parent().data("field"),i=$(this).data("field"),t=$(this).parent().parent().data("mode"),l=$(this).parent().parent().data("group"),a=$(this).parent().parent().data("refresh");if(e!==i){var o={id:$(this).parent().parent().data("id"),field:i};"in"===t?$.extend(o,{values:[]}):"date"!==t||p.startsWith(d[i],"date")||$.extend(o,{mode:"in",values:[]}),l&&p.updateWhere(f,{id:l,head:!1}),p.updateWhere(f,o),0<$(".soul-edit-out").length&&($('.soul-edit-out li[data-id="'+o.id+'"]').data(o).children(".item-field").html(n[i]),("in"===o.mode||"date"===t&&"date"!==o.mode)&&($('.soul-edit-out li[data-id="'+o.id+'"]').children(".item-type").html("筛选数据"),$('.soul-edit-out li[data-id="'+o.id+'"]').children(".item-value").html("共0条数据"))),!0===a&&p.soulReload(f)}}),$("#soul-bf-type"+y+">ul>li").off("click").on("click",function(){var e=$(this).data("value")+"",i=$(this).data("mode"),t=$(this).parent().parent().data("type"),l=$(this).parent().parent().data("mode"),a=$(this).parent().parent().data("group"),o=$(this).parent().parent().data("refresh");if(t!==e){var d={id:$(this).parent().parent().data("id"),type:e,mode:i};if(l!==i&&$.extend(d,{value:"",values:[]}),a&&"in"===i&&p.updateWhere(f,{id:a,head:!1}),p.updateWhere(f,d),0<$(".soul-edit-out").length)switch($('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").show(),$('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-type").html(conditionChangeItems[e]||("in"===i?"筛选数据":"选择日期")),i){case"in":$('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").html("共0条数据");break;case"date":$('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").html(dateTimeItems[e]);break;case"condition":l!==i&&$('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value").html("请输入..."),$('.soul-edit-out li[data-id="'+d.id+'"]').data(d).children(".item-value")["null"===e||"notNull"===e?"hide":"show"]()}!0===o&&p.soulReload(f)}}),t.find(".condition-items .condition-item .condition-item-close").on("click",function(){p.updateWhere(f,{id:$(this).parents(".condition-item:eq(0)").data("id"),delete:!0}),p.soulReload(f)})},export:function(i,h){"string"==typeof i&&(i=table_cache[i]);var e=layer.msg("文件下载中",{icon:16,time:-1,anim:-1,fixed:!1}),f=this.deepClone(i.cols),t=i.elem.next().find("style")[0],l=t.sheet||t.styleSheet||{},a=l.cssRules||l.rules;layui.each(a,function(e,i){if(i.style.width){var t=i.selectorText.split("-");f[t[3]][t[4]].width=parseInt(i.style.width)}});var o=JSON.parse(JSON.stringify(i.data||layui.table.cache[i.id])),d={},n={},s=[],r={},c=$(i.elem),p=c.next().children(".layui-table-box").children(".layui-table-body").children("table"),m=void 0===i.excel||!(!i.excel||void 0!==i.excel.on&&!i.excel.on)&&i.excel;m=!0===m?{}:m||{};var u=(h=h||{}).filename?"function"==typeof h.filename?h.filename.call(this):h.filename:m.filename?"function"==typeof m.filename?m.filename.call(this):m.filename:"表格数据.xlsx",y=!0===h.checked||!0===m.checked,v=void 0===h.columns?m.columns:h.columns,b=void 0===h.totalRow?m.totalRow:h.totalRow,g=u.substring(u.lastIndexOf(".")+1,u.length),x=m.add&&m.add.top&&Array.isArray(m.add.top.data)?m.add.top.data.length+1:1,k=m.add&&m.add.bottom&&Array.isArray(m.add.bottom.data)?m.add.bottom.data.length:0;if(y)o=table.checkStatus(i.id).data;else if(i.url&&i.page){var C=!0;if($.ajax({url:i.url,data:isFilterCache[i.id]?where_cache[i.id]:table_cache[i.id].where,dataType:"json",method:"post",async:!1,cache:!1,headers:i.headers||{},contentType:i.contentType,success:function(e){"function"==typeof i.parseData&&(e=i.parseData(e)||e),o=e.data},error:function(e){layer.msg("请求异常！",{icon:2,anim:6}),C=!1}}),!C)return}else{var w=c.next().children(".layui-table-box").children(".layui-table-header").find('.layui-table-sort[lay-sort$="sc"]:eq(0)');if(0<w.length){var L=w.parent().parent().data("field");switch(w.attr("lay-sort")){case"asc":o=layui.sort(o,L);break;case"desc":o=layui.sort(o,L,!0)}}}var S,I,O,D,T,N=[];for(S=0;S<f.length;S++)for(I=0;I<f[S].length;I++)if(!f[S][I].exportHandled){if(1<f[S][I].rowspan)for(s.push([Y(I+1)+(S+x),Y(I+1)+(S+parseInt(f[S][I].rowspan)+x-1)]),(T=this.deepClone(f[S][I])).exportHandled=!0,O=S+1;O<f.length;)f[O].splice(I,0,T),O++;if(1<f[S][I].colspan){for(s.push([Y(I+1)+(S+x),Y(I+parseInt(f[S][I].colspan))+(S+x)]),(T=this.deepClone(f[S][I])).exportHandled=!0,O=1;O<f[S][I].colspan;O++)f[S].splice(I,0,T);I=I+f[S][I].colspan-1}}var _=f[f.length-1];if(!1!==b&&i.totalRow){var F={},R={};for(S=0;S<_.length;S++)_[S].totalRowText?F["numbers"===_[S].type?"LAY_TABLE_INDEX":_[S].field]=_[S].totalRowText:_[S].totalRow&&(R["numbers"===_[S].type?"LAY_TABLE_INDEX":_[S].field]=0);if("{}"!==JSON.stringify(R))for(S=0;S<o.length;S++)for(var E in R)R[E]+=Number(o[S][E])||0;o.push(Object.assign(F,R))}if(v&&Array.isArray(v)){var P=[];for(D={},s=[],N[0]={},S=0;S<v.length;S++)for(I=0;I<_.length;I++)if(_[I].field===v[S]){P.push(_[I]),N[0]["numbers"===_[I].type?"LAY_TABLE_INDEX":_[I].field]=_[I],D["numbers"===_[I].type?"LAY_TABLE_INDEX":_[I].field]=_[I].title;break}_=P,o.splice(0,0,D)}else for(S=0;S<f.length;S++){for(N[S]={},D={},I=0;I<f[S].length;I++)N[S]["numbers"===f[S][I].type?"LAY_TABLE_INDEX":f[f.length-1][I].field]=f[S][I],D["numbers"===f[S][I].type?"LAY_TABLE_INDEX":f[f.length-1][I].field]=f[S][I].title;o.splice(S,0,D)}if(m.add){var A,B,W,H=m.add.top,J=m.add.bottom;if(H&&Array.isArray(H.data)&&0<H.data.length){for(S=0;S<H.data.length;S++){for(D={},I=W=0;I<(H.data[S].length>_.length?H.data[S].length:_.length);I++)!_[I].field&&"numbers"!==_[I].type||_[I].hide?W++:D[_[I]?"numbers"===_[I].type?"LAY_TABLE_INDEX":_[I].field:I+""]=H.data[S][I-W]||"";o.splice(S,0,D)}if(Array.isArray(H.heights)&&0<H.heights.length)for(S=0;S<H.heights.length;S++)r[S]=H.heights[S];if(Array.isArray(H.merge)&&0<H.merge.length)for(S=0;S<H.merge.length;S++)2===H.merge[S].length&&(A=H.merge[S][0].split(","),B=H.merge[S][1].split(","),s.push([Y(A[1])+A[0],Y(B[1])+B[0]]))}if(J&&Array.isArray(J.data)&&0<J.data.length){for(S=0;S<J.data.length;S++){for(D={},I=W=0;I<(J.data[S].length>_.length?J.data[S].length:_.length);I++)!_[I].field&&"numbers"!==_[I].type||_[I].hide?W++:D[_[I]?"numbers"===_[I].type?"LAY_TABLE_INDEX":_[I].field:I+""]=J.data[S][I-W]||"";o.push(D)}if(Array.isArray(J.heights)&&0<J.heights.length)for(S=0;S<J.heights.length;S++)r[o.length-J.data.length+S]=J.heights[S];if(Array.isArray(J.merge)&&0<J.merge.length)for(S=0;S<J.merge.length;S++)2===J.merge[S].length&&(A=J.merge[S][0].split(","),B=J.merge[S][1].split(","),s.push([Y(A[1])+(o.length-J.data.length+parseInt(A[0])),Y(B[1])+(o.length-J.data.length+parseInt(B[0]))]))}}var q=0,X={left:"top",center:"center",right:"bottom"},j=["top","bottom","left","right"];for(S=0;S<_.length;S++)!_[S].field&&"numbers"!==_[S].type||_[S].hide||(_[S].width&&(n[String.fromCharCode(64+parseInt(++q))]=_[S].width),d["numbers"===_[S].type?"LAY_TABLE_INDEX":_[S].field]=function(e,i,t,l){var a="ffffff",o="000000",d="Calibri",n=12,s="s",r=l-(v?1:f.length)-x+1,c={top:{style:"thin",color:{indexed:64}},bottom:{style:"thin",color:{indexed:64}},left:{style:"thin",color:{indexed:64}},right:{style:"thin",color:{indexed:64}}};if(m.border)for(I=0;I<j.length;I++)m.border[j[I]]?(c[j[I]].style=m.border[j[I]].style||c[j[I]].style,c[j[I]].color=U(m.border[j[I]].color)||c[j[I]].color):(m.border.color||m.border.style)&&(c[j[I]].style=m.border.style||c[j[I]].style,c[j[I]].color=U(m.border.color)||c[j[I]].color);if(l<x-1||l>=t.length-k)return{v:i[e]||"",s:{alignment:{horizontal:"center",vertical:"center"},font:{name:d,sz:n,color:{rgb:o}},fill:{fgColor:{rgb:a,bgColor:{indexed:64}}},border:c},t:s};if(r<0)a="C7C7C7",m.head&&(a=m.head.bgColor||a,o=m.head.color||o,d=m.head.family||d,n=m.head.size||n),h.head&&(a=h.head.bgColor||a,o=h.head.color||o,d=h.head.family||d,n=h.head.size||n);else{if(m.font&&(a=m.font.bgColor||a,o=m.font.color||o,d=m.font.family||d,n=m.font.size||n),h.font&&(a=h.font.bgColor||a,o=h.font.color||o,d=h.font.family||d,n=h.head.size||n),h.border)for(I=0;I<j.length;I++)h.border[j[I]]?(c[j[I]].style=h.border[j[I]].style||c[j[I]].style,c[j[I]].color=U(h.border[j[I]].color)||c[j[I]].color):(h.border.color||h.border.style)&&(c[j[I]].style=h.border.style||c[j[I]].style,c[j[I]].color=U(h.border.color)||c[j[I]].color);if(N[N.length-1][e].excel){var u="function"==typeof N[N.length-1][e].excel?N[N.length-1][e].excel.call(this,i,r,t.length-f.length-x+1-k):N[N.length-1][e].excel;if(u&&(a=u.bgColor||a,o=u.color||o,d=u.family||d,n=u.size||n,s=u.cellType||s,u.border))for(I=0;I<j.length;I++)u.border[j[I]]?(c[j[I]].style=u.border[j[I]].style||c[j[I]].style,c[j[I]].color=U(u.border[j[I]].color)||c[j[I]].color):(u.border.color||u.border.style)&&(c[j[I]].style=u.border.style||c[j[I]].style,c[j[I]].color=U(u.border.color)||c[j[I]].color)}}return{v:0<=r&&N[N.length-1][e].templet?"function"==typeof N[N.length-1][e].templet?0===$("<div>"+N[N.length-1][e].templet(i)+"</div>").find(":input").length?$("<div>"+N[N.length-1][e].templet(i)+"</div>").text():p.children("tbody").children("tr[data-index="+r+"]").children('td[data-field="'+e+'"]').find(":input").val()||i[e]||"":0===$("<div>"+laytpl($(N[N.length-1][e].templet).html()||String(N[N.length-1][e].templet)).render(i)+"</div>").find(":input").length?$("<div>"+laytpl($(N[N.length-1][e].templet).html()||String(N[N.length-1][e].templet)).render(i)+"</div>").text():p.children("tbody").children("tr[data-index="+r+"]").children('td[data-field="'+e+'"]').find(":input").val()||i[e]||"":0<=r&&"LAY_TABLE_INDEX"===e?r+1:i[e]||"",s:{alignment:{horizontal:N[r<-1?l-x+1:N.length-1][e].align?X[N[r<-1?l-x+1:N.length-1][e].align]:"top",vertical:"center"},font:{name:d,sz:n,color:{rgb:o}},fill:{fgColor:{rgb:a,bgColor:{indexed:64}}},border:c},t:s}});function U(e){return e?{rgb:e}:e}function Y(e){for(var i=[];e;){var t=e%26;t||(t=26,--e),String.fromCodePoint||function(d){var i=function(e){for(var i=[],t="",l=0,a=arguments.length;l!==a;++l){var o=+arguments[l];if(!(o<1114111&&o>>>0===o))throw RangeError("Invalid code point: "+o);16383<=(o<=65535?i.push(o):(o-=65536,i.push(55296+(o>>10),o%1024+56320)))&&(t+=d.apply(null,i),i.length=0)}return t+d.apply(null,i)};try{Object.defineProperty(String,"fromCodePoint",{value:i,configurable:!0,writable:!0})}catch(e){String.fromCodePoint=i}}(String.fromCharCode),i.push(String.fromCodePoint(t+64)),String.fromCodePoint||function(d){var i=function(e){for(var i=[],t="",l=0,a=arguments.length;l!==a;++l){var o=+arguments[l];if(!(o<1114111&&o>>>0===o))throw RangeError("Invalid code point: "+o);16383<=(o<=65535?i.push(o):(o-=65536,i.push(55296+(o>>10),o%1024+56320)))&&(t+=d.apply(null,i),i.length=0)}return t+d.apply(null,i)};try{Object.defineProperty(String,"fromCodePoint",{value:i,configurable:!0,writable:!0})}catch(e){String.fromCodePoint=i}}(String.fromCharCode),e=~~(e/26)}return i.reverse().join("")}excel.exportExcel({sheet1:excel.filterExportData(o,d)},u,g,{extend:{"!cols":excel.makeColConfig(n,80),"!merges":excel.makeMergeConfig(s),"!rows":excel.makeRowConfig(r,16)}}),layer.close(e)},startsWith:function(e,i){var t=new RegExp("^"+i);return e&&t.test(e)},deepClone:function(e){return this.deepParse(this.deepStringify(e))},deepStringify:function(e){var t="[[JSON_FUN_PREFIX_",l="_JSON_FUN_SUFFIX]]";return JSON.stringify(e,function(e,i){return"function"==typeof i?t+i.toString()+l:i})},deepParse:function(str){var JSON_SERIALIZE_FIX={PREFIX:"[[JSON_FUN_PREFIX_",SUFFIX:"_JSON_FUN_SUFFIX]]"};return JSON.parse(str,function(key,value){return"string"==typeof value&&0<value.indexOf(JSON_SERIALIZE_FIX.SUFFIX)&&0===value.indexOf(JSON_SERIALIZE_FIX.PREFIX)?eval("("+value.replace(JSON_SERIALIZE_FIX.PREFIX,"").replace(JSON_SERIALIZE_FIX.SUFFIX,"")+")"):value})||{}},getScrollWidth:function(e){var i=0;return e?i=e.offsetWidth-e.clientWidth:((e=document.createElement("div")).style.width="100px",e.style.height="100px",e.style.overflowY="scroll",document.body.appendChild(e),i=e.offsetWidth-e.clientWidth,document.body.removeChild(e)),i},getCompleteCols:function(e){var i,t,l,a,o=this.deepParse(this.deepStringify(e));for(i=0;i<o.length;i++)for(t=0;t<o[i].length;t++)if(!o[i][t].exportHandled){if(1<o[i][t].rowspan)for((a=this.deepClone(o[i][t])).exportHandled=!0,l=i+1;l<o.length;)o[l].splice(t,0,a),l++;if(1<o[i][t].colspan){for((a=this.deepClone(o[i][t])).exportHandled=!0,l=1;l<o[i][t].colspan;l++)o[i].splice(t,0,a);t=t+o[i][t].colspan-1}}return o[o.length-1]},cache:cache};exports("tableFilter",mod)});